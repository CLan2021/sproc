# sproc (SPecies Range Overlap Calculator)

``sproc`` is a Python package with the objective of visualizing and quantifying the overlap between the ranges of two taxa as determined by latitude/longitude occurrence data.



### Utility of proposal

Determining range overlap has applications to investigating patterns of hybridization (the source of inspiration for this proposal).  Observations of hybrids in the wild may inform inquiries into the ranges and co-occurrence of the putative parent taxa, which ``sproc`` can facilitate.  ``sproc`` may help to infer instances of reproductive incompatibility: if two taxa demonstrate significant overlap but no putatitve hybrid exists, it is likely that such a hybrid cannot exist or would be inviable.

Range overlap may also be useful to investigate other evolutionary or ecological questions.  ``sproc`` may expand to address some of these additional topics in future versions.



### Data sources and input

The class object ``Sproc`` utilizes the ``pygbif`` package, which is itself a wrapper around the REST API for the Global Biodiversity Information Facility (GBIF) database.  ``Sproc`` calls the Species module as part of query formatting and the Occurrence module to request occurrence data.  Please refer to the [documentation](https://www.gbif.org/developer/summary) for more details about the API.  *Note that the Occurrence module imposes a hard limit of 100,000 records for individual queries.  Users seeking to retrieve records beyond this limit should follow GBIF's instructions for their asynchronous download service.*

``Sproc`` accepts species names and latitude/longitude bounding ranges, which are formatted as queries to GBIF to retrieve occurrence data and returned as CSV files.  See the below example of a query and retrieved data:


![](https://i.gyazo.com/d46e90ebeda6a29952eb463e5f4c603a.png)


``sproc`` includes several utility functions for visualizing ranges from occurrence data.  All of them require CSV files with dedicated columns for latitude/longitude data.  The class object ``Sproc`` generates CSV files from queries as described above, which may be passed to the utility functions; alternatively, the user can supply CSV data from any source that provides latitude/longitude data.  The ``calculate_overlay`` function determines and plots the geometric shape of overlap between two ranges.  It requires two sets of latitude/longitude data; here, CSV format is not required, but the user may choose to source the data from the CSV files generated by ``Sproc``, or alternatively use a different source.



### User interaction and output

``sproc`` is designed for use as an API such as a Jupyter notebook, given the highly visual nature of many of its utility functions.  The utility functions require only longitude/latitude data to execute, but users may optionally provide additional parameters to style the plotting.  See the below example (under active development and subject to change):


![](https://i.gyazo.com/0d9a93c02607e53efa1aad8174d27dd5.jpg)



### Related tools

``NichePy`` is a command line tool written in Python that calculates overlap metrics for ecological niche and species distribution models.  ``smood`` is a Python package that relies on the Java tool ``Maxent`` to model species niches and distributions.  These tools require latitude/longitude data similar to ``sproc``, but differ in their focus on modeling niche evolution as opposed to visualizing and calculating range geometries.

The R packages ``PBSmapping`` and ``adehabitatHR`` include functions to calculate convex hull shapes from a set of geographical points.  The ``calculate_overlay`` function in ``sproc`` uses alpha shapes, which are essentially a "tighter" version of convex hulls.  ``PBSmapping`` additionally includes plotting functions.

To my knowledge, no Python package exists that focuses specifically on the visualization and quantification of geometric range overlap.  The above tools may serve as inspiration for further development of ``sproc``, including potentially expanding its scope to address additional evolutionary and ecological topics.
